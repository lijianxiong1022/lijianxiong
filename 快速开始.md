# 快速开始指南

## 一、环境准备

### 1.1 安装Python
确保已安装 Python 3.8 或更高版本
```bash
python --version
```

### 1.2 安装MySQL
确保MySQL已安装并运行
```bash
mysql --version
```

## 二、后端部署

### 2.1 进入后端目录
```bash
cd backend
```

### 2.2 安装Python依赖
```bash
pip install -r requirements.txt
```

如果使用虚拟环境（推荐）：
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

pip install -r requirements.txt
```

### 2.3 配置环境变量
```bash
# 复制环境变量示例文件
cp .env.example .env

# 编辑 .env 文件，修改数据库配置
# DB_HOST=localhost
# DB_PORT=3306
# DB_USER=root
# DB_PASSWORD=your_password
# DB_NAME=order_system
```

### 2.4 创建数据库
```bash
# 使用MySQL命令行
mysql -u root -p < ../database/init.sql

# 或者手动执行
mysql -u root -p
CREATE DATABASE order_system DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2.5 初始化数据库
```bash
python init_db.py
```

这将：
- 创建所有数据库表
- 创建默认管理员账户（admin/admin123）

### 2.6 启动后端服务
```bash
python app.py
```

服务将在 `http://localhost:5000` 启动

## 三、前端对接

### 3.1 修改API地址
在 `all_pages.html` 和 `admin.html` 中，确保引用了 `api.js`：
```html
<script src="api.js"></script>
```

### 3.2 切换到生产API
```bash
# 备份当前api.js
cp api.js api.js.backup

# 使用生产版本
cp api.production.js api.js
```

### 3.3 配置API地址
如果后端不在 `http://localhost:5000`，需要修改 `api.js` 中的 `API_BASE_URL`：
```javascript
const API_BASE_URL = 'http://your-backend-url:5000/api/v1';
```

### 3.4 启用前端API调用
在 `all_pages.html` 中，找到以下函数并取消注释API调用：

1. **注册功能** - `handleRegister()` 函数
2. **登录功能** - 登录按钮的onclick
3. **报单功能** - `confirmPointsDeduction()` 函数
4. **添加非会员** - `saveNonmemberUser()` 函数

## 四、测试验证

### 4.1 测试用户注册
1. 打开 `all_pages.html`
2. 点击"立即注册"
3. 填写注册信息
4. 点击注册
5. 检查是否注册成功并自动登录

### 4.2 测试用户登录
1. 使用注册的手机号和密码登录
2. 检查是否成功跳转到报单页面

### 4.3 测试报单功能
1. 先添加几个非会员用户
2. 选择非会员用户
3. 点击报单
4. 选择报单日期
5. 确认报单
6. 检查金币是否正确扣除

### 4.4 测试管理员登录
1. 打开 `admin.html`
2. 使用 admin/admin123 登录
3. 检查是否成功进入后台

## 五、常见问题

### 5.1 数据库连接失败
- 检查MySQL服务是否运行
- 检查 `.env` 中的数据库配置是否正确
- 检查数据库用户权限

### 5.2 CORS跨域错误
- 确保后端已安装 `Flask-CORS`
- 检查 `app.py` 中是否已启用CORS

### 5.3 Token过期
- 检查JWT配置中的过期时间
- 前端会自动处理401错误并跳转登录

### 5.4 密码加密问题
- 确保使用 `hash_password` 函数加密密码
- 管理员密码也需要加密

## 六、下一步

1. **完善其他API接口**
   - 金币转账
   - 奖励查询
   - 后台管理功能

2. **前端功能对接**
   - 逐步取消注释前端API调用
   - 测试所有功能

3. **优化和测试**
   - 性能优化
   - 安全加固
   - 完整测试

4. **部署上线**
   - 配置生产环境
   - 部署到服务器
   - 配置HTTPS

## 需要帮助？

如果遇到问题，请检查：
1. 后端日志输出
2. 浏览器控制台错误
3. 网络请求（F12 -> Network）
4. 数据库数据是否正确


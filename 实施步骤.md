# å‰åç«¯å¯¹æ¥å®æ–½æ­¥éª¤

## å¿«é€Ÿå¼€å§‹æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡åç«¯ç¯å¢ƒ

1. **é€‰æ‹©åç«¯æŠ€æœ¯æ ˆ**
   - Python: Flask + SQLAlchemy + JWT
   - Node.js: Express + Sequelize + jsonwebtoken
   - å…¶ä»–: æ ¹æ®å›¢é˜ŸæŠ€æœ¯æ ˆé€‰æ‹©

2. **åˆ›å»ºåç«¯é¡¹ç›®**
   ```bash
   # Python Flaskç¤ºä¾‹
   mkdir backend
   cd backend
   pip install flask flask-sqlalchemy flask-jwt-extended mysql-connector-python
   
   # Node.js Expressç¤ºä¾‹
   mkdir backend
   cd backend
   npm init -y
   npm install express sequelize mysql2 jsonwebtoken bcrypt
   ```

3. **é…ç½®æ•°æ®åº“è¿æ¥**
   - åˆ›å»ºæ•°æ®åº“
   - é…ç½®è¿æ¥ä¿¡æ¯
   - è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬

### ç¬¬äºŒæ­¥ï¼šå®ç°æ ¸å¿ƒAPIï¼ˆä¼˜å…ˆçº§æ’åºï¼‰

#### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»é¦–å…ˆå®ç°ï¼‰

1. **ç”¨æˆ·è®¤è¯API**
   - `POST /api/v1/user/register` - ç”¨æˆ·æ³¨å†Œ
   - `POST /api/v1/user/login` - ç”¨æˆ·ç™»å½•
   - `POST /api/v1/admin/login` - ç®¡ç†å‘˜ç™»å½•

2. **æŠ¥å•æ ¸å¿ƒAPI**
   - `POST /api/v1/orders` - åˆ›å»ºæŠ¥å•
   - `GET /api/v1/orders` - è·å–è®¢å•åˆ—è¡¨

3. **ç”¨æˆ·ä¿¡æ¯API**
   - `GET /api/v1/user/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
   - `GET /api/v1/points/balance` - è·å–é‡‘å¸ä½™é¢

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½å®Œå–„ï¼‰

4. **ç”¨æˆ·ç®¡ç†API**
   - `GET /api/v1/users/nonmembers` - è·å–éä¼šå‘˜åˆ—è¡¨
   - `POST /api/v1/users/nonmembers` - æ·»åŠ éä¼šå‘˜
   - `POST /api/v1/points/transfer` - è½¬è´¦é‡‘å¸

5. **åå°ç®¡ç†åŸºç¡€API**
   - `GET /api/v1/admin/members` - è·å–ä¼šå‘˜åˆ—è¡¨
   - `GET /api/v1/admin/agents` - è·å–ä»£ç†åˆ—è¡¨
   - `GET /api/v1/admin/settings` - è·å–ç³»ç»Ÿé…ç½®

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰

6. **å…¶ä»–ç®¡ç†åŠŸèƒ½API**
   - äº¤æ˜“æŸ¥è¯¢
   - å¼‚å¸¸è®¢å•å¤„ç†
   - æ•°æ®å¤‡ä»½
   - ç³»ç»Ÿé€šçŸ¥

### ç¬¬ä¸‰æ­¥ï¼šå‰ç«¯å¯¹æ¥æ”¹é€ 

#### 3.1 æ›¿æ¢APIæ–‡ä»¶

1. **å¤‡ä»½å½“å‰api.js**
   ```bash
   cp api.js api.js.backup
   ```

2. **ä½¿ç”¨ç”Ÿäº§ç‰ˆæœ¬**
   ```bash
   cp api.production.js api.js
   ```

3. **æˆ–è€…æ‰‹åŠ¨ä¿®æ”¹api.js**
   - å°† `request` æ–¹æ³•æ”¹ä¸ºçœŸå®APIè°ƒç”¨
   - åˆ é™¤æ‰€æœ‰ `mockResponse` ç›¸å…³ä»£ç 
   - æ·»åŠ ç”¨æˆ·ç«¯APIæ–¹æ³•

#### 3.2 å¯ç”¨å‰ç«¯APIè°ƒç”¨

åœ¨ `all_pages.html` ä¸­ï¼š

1. **æ³¨å†ŒåŠŸèƒ½**
   ```javascript
   // æ‰¾åˆ° handleRegister å‡½æ•°
   // å–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç ï¼š
   const response = await apiService.register({ 
     name, phone, password, promoCode, payPassword 
   });
   ```

2. **ç™»å½•åŠŸèƒ½**
   ```javascript
   // æ‰¾åˆ°ç™»å½•æŒ‰é’®çš„onclick
   // æ”¹ä¸ºï¼š
   async function handleUserLogin() {
     const phone = document.getElementById('login-phone').value;
     const password = document.getElementById('login-password').value;
     const response = await apiService.userLogin(phone, password);
     if (response.success) {
       showPage('orders-page');
     } else {
       alert(response.message);
     }
   }
   ```

3. **æŠ¥å•åŠŸèƒ½**
   ```javascript
   // åœ¨ confirmPointsDeduction å‡½æ•°ä¸­
   const orderData = {
     nonMemberIds: getSelectedNonMemberIds(),
     settlementDate: settlementDateInput.value,
     quantity: pendingOrderCount
   };
   const response = await apiService.createOrder(orderData);
   ```

#### 3.3 å¤„ç†APIå“åº”

1. **æˆåŠŸå“åº”å¤„ç†**
   ```javascript
   if (response.success) {
     // æ›´æ–°UI
     // æ˜¾ç¤ºæˆåŠŸæç¤º
   } else {
     alert(response.message || 'æ“ä½œå¤±è´¥');
   }
   ```

2. **é”™è¯¯å¤„ç†**
   ```javascript
   try {
     const response = await apiService.someMethod();
     // å¤„ç†å“åº”
   } catch (error) {
     console.error('APIè°ƒç”¨å¤±è´¥:', error);
     alert('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
   }
   ```

### ç¬¬å››æ­¥ï¼šæµ‹è¯•éªŒè¯

#### 4.1 æ¥å£æµ‹è¯•

ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•æ¯ä¸ªAPIï¼š

```bash
# æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:5000/api/v1/user/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æµ‹è¯•ç”¨æˆ·",
    "phone": "13800138000",
    "password": "123456",
    "promoCode": "123456",
    "payPassword": "123456"
  }'

# æµ‹è¯•ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:5000/api/v1/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "123456"
  }'
```

#### 4.2 å‰ç«¯åŠŸèƒ½æµ‹è¯•

1. **ç”¨æˆ·æ³¨å†Œæµç¨‹**
   - å¡«å†™æ³¨å†Œä¿¡æ¯
   - éªŒè¯æ¨å¹¿ç å”¯ä¸€æ€§
   - æäº¤æ³¨å†Œ
   - æ£€æŸ¥æ˜¯å¦è‡ªåŠ¨ç™»å½•

2. **æŠ¥å•æµç¨‹**
   - æ·»åŠ ç”¨æˆ·åˆ°æŠ¥å•åˆ—è¡¨
   - é€‰æ‹©æŠ¥å•æ—¥æœŸ
   - ç¡®è®¤æŠ¥å•
   - æ£€æŸ¥é‡‘å¸æ‰£é™¤æ˜¯å¦æ­£ç¡®

3. **åå°ç®¡ç†æµç¨‹**
   - ç®¡ç†å‘˜ç™»å½•
   - æŸ¥çœ‹ä¼šå‘˜åˆ—è¡¨
   - æŸ¥çœ‹ä»£ç†åˆ—è¡¨
   - ä¿®æ”¹ç³»ç»Ÿé…ç½®

### ç¬¬äº”æ­¥ï¼šé—®é¢˜æ’æŸ¥

#### å¸¸è§é—®é¢˜

1. **CORSè·¨åŸŸé—®é¢˜**
   ```javascript
   // åç«¯éœ€è¦è®¾ç½®CORS
   // Flaskç¤ºä¾‹
   from flask_cors import CORS
   CORS(app)
   
   // Expressç¤ºä¾‹
   const cors = require('cors');
   app.use(cors());
   ```

2. **Tokenè¿‡æœŸå¤„ç†**
   - å‰ç«¯æ£€æµ‹401çŠ¶æ€ç 
   - è‡ªåŠ¨æ¸…é™¤token
   - è·³è½¬ç™»å½•é¡µé¢

3. **æ•°æ®æ ¼å¼ä¸åŒ¹é…**
   - æ£€æŸ¥APIå“åº”æ ¼å¼
   - æ£€æŸ¥å‰ç«¯æ•°æ®è§£æ
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

### ç¬¬å…­æ­¥ï¼šéƒ¨ç½²ä¸Šçº¿

1. **åç«¯éƒ¨ç½²**
   - é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
   - è®¾ç½®æ•°æ®åº“è¿æ¥
   - å¯åŠ¨åç«¯æœåŠ¡

2. **å‰ç«¯éƒ¨ç½²**
   - ä¿®æ”¹API_BASE_URLä¸ºç”Ÿäº§åœ°å€
   - éƒ¨ç½²é™æ€æ–‡ä»¶åˆ°æœåŠ¡å™¨æˆ–CDN
   - é…ç½®HTTPS

3. **æ•°æ®åº“å¤‡ä»½**
   - è®¾ç½®å®šæœŸå¤‡ä»½
   - æµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹

## å¼€å‘å»ºè®®

### 1. åˆ†é˜¶æ®µå®æ–½
- å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼ˆæ³¨å†Œã€ç™»å½•ã€æŠ¥å•ï¼‰
- å†å®Œå–„å…¶ä»–åŠŸèƒ½
- æœ€åä¼˜åŒ–å’Œæµ‹è¯•

### 2. ä¿æŒæ²Ÿé€š
- å‰åç«¯æ¥å£å®šä¹‰è¦ä¸€è‡´
- åŠæ—¶åŒæ­¥æ¥å£å˜æ›´
- ä½¿ç”¨æ¥å£æ–‡æ¡£ä¿æŒåŒæ­¥

### 3. æµ‹è¯•é©±åŠ¨
- å…ˆå†™æ¥å£æµ‹è¯•
- å†å®ç°åŠŸèƒ½
- æœ€åå‰ç«¯å¯¹æ¥

### 4. ç‰ˆæœ¬æ§åˆ¶
- ä½¿ç”¨Gitç®¡ç†ä»£ç 
- å‰åç«¯åˆ†å¼€ä»“åº“æˆ–ä½¿ç”¨monorepo
- é‡è¦èŠ‚ç‚¹æ‰“tag

## éœ€è¦æˆ‘ååŠ©çš„éƒ¨åˆ†

1. **åç«¯æ¡†æ¶é€‰æ‹©** - æˆ‘å¯ä»¥å¸®ä½ é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ
2. **æ•°æ®åº“è®¾è®¡ä¼˜åŒ–** - å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´è¡¨ç»“æ„
3. **APIæ¥å£å®ç°** - å¯ä»¥æä¾›å…·ä½“ä»£ç ç¤ºä¾‹
4. **å‰ç«¯å¯¹æ¥ä»£ç ** - å¯ä»¥å¸®ä½ ä¿®æ”¹å…·ä½“çš„å‡½æ•°
5. **é”™è¯¯å¤„ç†ä¼˜åŒ–** - å¯ä»¥å®Œå–„é”™è¯¯å¤„ç†é€»è¾‘

å‘Šè¯‰æˆ‘ä½ é€‰æ‹©çš„åç«¯æŠ€æœ¯æ ˆï¼Œæˆ‘å¯ä»¥æä¾›æ›´å…·ä½“çš„å®ç°ä»£ç ï¼


# ğŸš€ æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¶æ„

```
æœ¬åœ°å¼€å‘ç¯å¢ƒ (Windows)
â”œâ”€â”€ SQLiteæ•°æ®åº“ï¼ˆå¼€å‘ç”¨ï¼‰
â”œâ”€â”€ å‰ç«¯ï¼šhttp://localhost:5000
â””â”€â”€ åç«¯ï¼šhttp://localhost:5000/api/v1

è…¾è®¯äº‘æœåŠ¡å™¨ (CentOS)
â”œâ”€â”€ MySQLæ•°æ®åº“ï¼ˆç”Ÿäº§ç”¨ï¼‰
â”œâ”€â”€ Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ Gunicorn/Systemdè¿›ç¨‹ç®¡ç†
â””â”€â”€ å‰ç«¯é™æ€æ–‡ä»¶ + åç«¯API
```

---

## ğŸ¯ ç¬¬ä¸€æ­¥ï¼šæœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

### 1.1 è¿æ¥æœåŠ¡å™¨
```bash
ssh root@your_server_ip
```

### 1.2 å®‰è£…Python 3
```bash
# CentOS 7/8
sudo yum install -y python3 python3-pip python3-devel

# æˆ–è€…ä½¿ç”¨Python 3.8+
sudo yum install -y gcc openssl-devel bzip2-devel libffi-devel
cd /usr/src
sudo wget https://www.python.org/ftp/python/3.9.16/Python-3.9.16.tgz
sudo tar xzf Python-3.9.16.tgz
cd Python-3.9.16
sudo ./configure --enable-optimizations
sudo make altinstall
```

### 1.3 å®‰è£…MySQLå®¢æˆ·ç«¯å’Œä¾èµ–
```bash
sudo yum install -y mysql-devel gcc
```

### 1.4 åˆ›å»ºé¡¹ç›®ç›®å½•
```bash
sudo mkdir -p /var/www/order-system
sudo chown -R $USER:$USER /var/www/order-system
cd /var/www/order-system
```

---

## ğŸ—„ï¸ ç¬¬äºŒæ­¥ï¼šé…ç½®MySQLæ•°æ®åº“

### 2.1 åˆ›å»ºæ•°æ®åº“
```bash
mysql -u root -p
```

åœ¨MySQLä¸­æ‰§è¡Œï¼š
```sql
CREATE DATABASE order_system DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'order_user'@'localhost' IDENTIFIED BY 'your_strong_password';
GRANT ALL PRIVILEGES ON order_system.* TO 'order_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 2.2 æµ‹è¯•æ•°æ®åº“è¿æ¥
```bash
mysql -u order_user -p order_system
```

---

## ğŸ“¦ ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

### æ–¹æ³•1ï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /var/www/order-system
git clone your_repository_url .

# æˆ–è€…å¦‚æœå·²æœ‰ä»“åº“
git pull origin main
```

### æ–¹æ³•2ï¼šä½¿ç”¨SCPä¸Šä¼ 
```bash
# åœ¨æœ¬åœ°Windows PowerShellæˆ–CMD
scp -r E:\360MoveData\Users\86182\Desktop\test1\* root@your_server_ip:/var/www/order-system/
```

### æ–¹æ³•3ï¼šä½¿ç”¨FTPå·¥å…·
ä½¿ç”¨FileZillaã€WinSCPç­‰å·¥å…·ä¸Šä¼ æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹

---

## âš™ï¸ ç¬¬å››æ­¥ï¼šé…ç½®ç”Ÿäº§ç¯å¢ƒ

### 4.1 åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º `/var/www/order-system/backend/.env.production`ï¼š

```bash
cd /var/www/order-system/backend
nano .env.production
```

å†…å®¹ï¼š
```env
# æ•°æ®åº“é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
USE_SQLITE=False
DB_HOST=localhost
DB_PORT=3306
DB_USER=order_user
DB_PASSWORD=your_strong_password
DB_NAME=order_system

# JWTé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼ï¼‰
JWT_SECRET_KEY=your-production-secret-key-change-this-$(openssl rand -hex 32)

# Flaské…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
FLASK_ENV=production
FLASK_DEBUG=False
FLASK_HOST=0.0.0.0
FLASK_PORT=5000
```

**é‡è¦**ï¼šç”Ÿæˆå®‰å…¨çš„JWTå¯†é’¥ï¼š
```bash
openssl rand -hex 32
```

### 4.2 å®‰è£…Pythonä¾èµ–
```bash
cd /var/www/order-system/backend
pip3 install -r requirements.txt
```

å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼š
```bash
pip3 install --user -r requirements.txt
```

### 4.3 åˆå§‹åŒ–æ•°æ®åº“
```bash
cd /var/www/order-system/backend
# å…ˆè®¾ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
export FLASK_ENV=production
python3 init_db.py
```

---

## ğŸ”§ ç¬¬äº”æ­¥ï¼šé…ç½®è¿›ç¨‹ç®¡ç†ï¼ˆSystemdï¼‰

### 5.1 åˆ›å»ºSystemdæœåŠ¡æ–‡ä»¶
```bash
sudo nano /etc/systemd/system/order-system.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Order System Flask Application
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/var/www/order-system/backend
Environment="PATH=/usr/local/bin:/usr/bin:/bin"
Environment="FLASK_ENV=production"
ExecStart=/usr/bin/python3 /var/www/order-system/backend/app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### 5.2 å¯åŠ¨æœåŠ¡
```bash
sudo systemctl daemon-reload
sudo systemctl enable order-system
sudo systemctl start order-system
sudo systemctl status order-system
```

### 5.3 æŸ¥çœ‹æ—¥å¿—
```bash
sudo journalctl -u order-system -f
```

---

## ğŸŒ ç¬¬å…­æ­¥ï¼šé…ç½®Nginxåå‘ä»£ç†ï¼ˆæ¨èï¼‰

### 6.1 å®‰è£…Nginx
```bash
sudo yum install -y nginx
sudo systemctl enable nginx
sudo systemctl start nginx
```

### 6.2 é…ç½®Nginx
```bash
sudo nano /etc/nginx/conf.d/order-system.conf
```

å†…å®¹ï¼š
```nginx
server {
    listen 80;
    server_name your_domain.com;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–IP

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/order-system;
        try_files $uri $uri/ /all_pages.html;
        index all_pages.html;
    }

    # åå°ç®¡ç†é¡µé¢
    location /admin {
        root /var/www/order-system;
        try_files $uri $uri/ /admin.html;
    }

    # åç«¯API
    location /api {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ä¸Šä¼ æ–‡ä»¶
    location /uploads {
        alias /var/www/order-system/backend/uploads;
    }

    # é™æ€èµ„æº
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        root /var/www/order-system;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### 6.3 æµ‹è¯•å¹¶é‡å¯Nginx
```bash
sudo nginx -t
sudo systemctl restart nginx
```

---

## ğŸ”’ ç¬¬ä¸ƒæ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# å¼€æ”¾HTTPå’ŒHTTPSç«¯å£
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload

# æˆ–è€…åªå¼€æ”¾80ç«¯å£
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --reload
```

---

## ğŸ“ ç¬¬å…«æ­¥ï¼šé…ç½®å‰ç«¯APIåœ°å€

### 8.1 ä¿®æ”¹å‰ç«¯APIé…ç½®

åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹å‰ç«¯æ–‡ä»¶ï¼Œå°†APIåœ°å€æ”¹ä¸ºæœåŠ¡å™¨åœ°å€ï¼š

**æ–¹æ³•1ï¼šåˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `config.production.js`ï¼š
```javascript
// config.production.js
const API_BASE_URL = 'http://your_server_ip/api/v1';
const USER_API_BASE_URL = 'http://your_server_ip/api/v1';
```

**æ–¹æ³•2ï¼šç›´æ¥ä¿®æ”¹ç°æœ‰æ–‡ä»¶**

ä¿®æ”¹ `user_api.js` å’Œ `api.js`ï¼š
```javascript
// åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ç¯å¢ƒåˆ¤æ–­
const isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
const API_BASE_URL = isProduction 
    ? 'http://your_server_ip/api/v1'  // ç”Ÿäº§ç¯å¢ƒ
    : 'http://localhost:5000/api/v1';  // å¼€å‘ç¯å¢ƒ
```

---

## ğŸš€ ç¬¬ä¹æ­¥ï¼šéƒ¨ç½²è„šæœ¬

### 9.1 åˆ›å»ºéƒ¨ç½²è„šæœ¬ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

```bash
nano /var/www/order-system/deploy.sh
```

å†…å®¹ï¼š
```bash
#!/bin/bash
# éƒ¨ç½²è„šæœ¬

cd /var/www/order-system

echo "å¼€å§‹éƒ¨ç½²..."

# æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨Gitï¼‰
# git pull origin main

# å®‰è£…/æ›´æ–°ä¾èµ–
cd backend
pip3 install -r requirements.txt

# è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰
# python3 migrate.py

# é‡å¯æœåŠ¡
sudo systemctl restart order-system

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status order-system

echo "éƒ¨ç½²å®Œæˆï¼"
```

è®¾ç½®æ‰§è¡Œæƒé™ï¼š
```bash
chmod +x /var/www/order-system/deploy.sh
```

---

## ğŸ”„ ç¬¬åæ­¥ï¼šæœ¬åœ°å¼€å‘é…ç½®

### 10.1 æœ¬åœ°ç¯å¢ƒé…ç½®ä¿æŒä¸å˜

æœ¬åœ° `backend/.env` æ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š
```env
# æœ¬åœ°å¼€å‘ç¯å¢ƒ - ä½¿ç”¨SQLite
USE_SQLITE=True

# JWTé…ç½®
JWT_SECRET_KEY=dev-secret-key-change-this-in-production-2023
JWT_ACCESS_TOKEN_EXPIRES=86400

# Flaské…ç½®
FLASK_ENV=development
FLASK_DEBUG=True
FLASK_HOST=0.0.0.0
FLASK_PORT=5000
```

### 10.2 å‰ç«¯å¼€å‘ç¯å¢ƒé…ç½®

ä¿®æ”¹ `user_api.js` å’Œ `api.js`ï¼Œæ·»åŠ ç¯å¢ƒåˆ¤æ–­ï¼š
```javascript
// è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
const getApiBaseUrl = () => {
    const hostname = window.location.hostname;
    if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return 'http://localhost:5000/api/v1';  // æœ¬åœ°å¼€å‘
    }
    return 'http://your_server_ip/api/v1';  // ç”Ÿäº§ç¯å¢ƒ
};

const API_BASE_URL = getApiBaseUrl();
const USER_API_BASE_URL = getApiBaseUrl();
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### æœåŠ¡å™¨ç«¯
- [ ] Python 3å·²å®‰è£…
- [ ] MySQLæ•°æ®åº“å·²åˆ›å»ºå¹¶é…ç½®
- [ ] é¡¹ç›®ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] `.env.production` é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] Pythonä¾èµ–å·²å®‰è£…
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–
- [ ] SystemdæœåŠ¡å·²é…ç½®å¹¶å¯åŠ¨
- [ ] Nginxå·²é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] é˜²ç«å¢™å·²å¼€æ”¾ç«¯å£
- [ ] å‰ç«¯APIåœ°å€å·²æ›´æ–°

### æœ¬åœ°å¼€å‘ç¯å¢ƒ
- [ ] `.env` æ–‡ä»¶é…ç½®ä¸ºå¼€å‘ç¯å¢ƒï¼ˆUSE_SQLITE=Trueï¼‰
- [ ] å‰ç«¯APIåœ°å€æŒ‡å‘ localhost
- [ ] æœ¬åœ°æœåŠ¡å¯ä»¥æ­£å¸¸å¯åŠ¨

---

## ğŸ” æµ‹è¯•éƒ¨ç½²

### 1. æµ‹è¯•åç«¯API
```bash
curl http://your_server_ip/api/v1/user/register
```

### 2. æµ‹è¯•å‰ç«¯é¡µé¢
åœ¨æµè§ˆå™¨è®¿é—®ï¼š
- ç”¨æˆ·ç«¯ï¼š`http://your_server_ip/all_pages.html`
- åå°ï¼š`http://your_server_ip/admin.html`

### 3. æµ‹è¯•æ•°æ®åº“è¿æ¥
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /var/www/order-system/backend
python3 -c "from app import create_app; from models import db; app = create_app(); app.app_context().push(); print('æ•°æ®åº“è¿æ¥æˆåŠŸ' if db.session.execute('SELECT 1').fetchone() else 'è¿æ¥å¤±è´¥')"
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

### æœ¬åœ°å¼€å‘å®Œæˆåï¼Œæ›´æ–°åˆ°æœåŠ¡å™¨ï¼š

**æ–¹æ³•1ï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰**
```bash
# æœ¬åœ°æäº¤ä»£ç 
git add .
git commit -m "æ›´æ–°è¯´æ˜"
git push origin main

# åœ¨æœåŠ¡å™¨ä¸Š
cd /var/www/order-system
git pull origin main
./deploy.sh
```

**æ–¹æ³•2ï¼šæ‰‹åŠ¨ä¸Šä¼ **
```bash
# åœ¨æœ¬åœ°æ‰“åŒ…ï¼ˆæ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼‰
# ä¸Šä¼ åˆ°æœåŠ¡å™¨åè§£å‹
cd /var/www/order-system
./deploy.sh
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### 1. æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u order-system -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 5000
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦è¿è¡Œï¼š`sudo systemctl status mysql`
- æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 3. é™æ€æ–‡ä»¶404
- æ£€æŸ¥Nginxé…ç½®ä¸­çš„è·¯å¾„
- æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š`sudo chmod -R 755 /var/www/order-system`

### 4. APIè¯·æ±‚å¤±è´¥
- æ£€æŸ¥CORSé…ç½®
- æ£€æŸ¥Nginxä»£ç†é…ç½®
- æŸ¥çœ‹åç«¯æ—¥å¿—

---

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - ä¿®æ”¹MySQL rootå¯†ç 
   - ä¿®æ”¹ç®¡ç†å‘˜é»˜è®¤å¯†ç ï¼ˆadmin/admin123ï¼‰

2. **é…ç½®HTTPS**
   - ç”³è¯·SSLè¯ä¹¦
   - é…ç½®Nginxæ”¯æŒHTTPS

3. **é™åˆ¶è®¿é—®**
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - ä½¿ç”¨fail2bané˜²æ­¢æš´åŠ›ç ´è§£

4. **å®šæœŸå¤‡ä»½**
   - é…ç½®æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
   - å¤‡ä»½ä¸Šä¼ çš„æ–‡ä»¶

---

## ğŸ“ åç»­æ”¯æŒ

éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥ï¼š
1. åœ¨æœ¬åœ°ç»§ç»­å¼€å‘
2. é€šè¿‡Gitæˆ–æ‰‹åŠ¨ä¸Šä¼ æ›´æ–°åˆ°æœåŠ¡å™¨
3. è¿è¡Œéƒ¨ç½²è„šæœ¬æ›´æ–°æœåŠ¡

**å»ºè®®å·¥ä½œæµç¨‹ï¼š**
```
æœ¬åœ°å¼€å‘ â†’ æµ‹è¯•é€šè¿‡ â†’ æäº¤ä»£ç  â†’ æœåŠ¡å™¨æ‹‰å– â†’ éƒ¨ç½²è„šæœ¬ â†’ æµ‹è¯•éªŒè¯
```

